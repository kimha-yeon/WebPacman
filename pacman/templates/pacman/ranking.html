{% load static %}
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Ranking</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Foldit:wght@500&display=swap" rel="stylesheet">
    <script src="https://kit.fontawesome.com/de74b38e3b.js" crossorigin="anonymous"></script>
    <script src="{% static 'MQTT/paho-mqtt.js' %}"></script>
    <script src="{% static 'MQTT/paho-mqtt-min.js' %}"></script>
</head>
<style>
    @font-face {
        font-family: pacmanfont;
        src: url("/static/fonts/Pacmanfont.ttf");
    }

body {
    background-color : black;
    color : white;
}

header {
    font-family: 'pacmanfont', cursive;
    margin-top : 20px;
    width : 440px;
    font-size: 90px;
    color: yellow;
    text-align : center;
    display: flex;
        justify-content: center;
        align-items: center;
}

.wrapper {
    width : 440px;
    height : 540px;
    margin: auto;
    margin-top : 120px;
    text-align : center;
}

.info_wrapper {
    height : 30px;
    text-align : right;
}

table {
    width : 450px;
}

</style>
<body>
<div class="wrapper">
    <div class="info_wrapper">
        <i class="fa-solid fa-house" onclick="location.href='{% url 'index' %}'" style="color:white; font-size:25px;"></i>
    </div>
        <header>Ranking</header>
        <table>
            <thead>
              <tr>
                  <th style="width:10%;">순위</th>
                  <th style="width:70%;">이름</th>
                  <th style="width:20%;">점수</th>
              </tr>
            </thead>

            <tbody>
            {% for ranker in ranker_list %}
              <tr>
                  <td>{{ forloop.counter }}</td>
                  <td>{{ ranker.name }}</td>
                  <td>{{ ranker.score }}</td>
              </tr>
            {% endfor %}
            </tbody>
        </table>
</div>
<script>
    var port = 8081;

    var client = new Paho.MQTT.Client('192.168.0.172', Number(port), "clientId");

    client.onConnectionLost = onConnectionLost;
    client.onMessageArrived = onMessageArrived;


    client.connect(
        {onSuccess: onConnect}
    );


    function onConnect() {
        console.log("onConnect");
        client.subscribe("pacman"); //토픽 설정
        client.publish('pacman', 'Hello mqtt')
        client.publish('pacman', 'test')
        client.publish('pacman', 'Hello mqtt')
        client.publish('pacman', 'Hello mqtt')
    }

    function onConnectionLost(responseObject){
        if(responseObject.errorCode != 0){
            console.log("onConnectionLost:" + responseObject.errorMessage);
        }
    }


    function onMessageArrived(message) {
      console.log("메시지:", message);
      console.log("목적지:", message.destinationName);
      console.log("페이로드 :", message.payloadBytes);
    };

</script>

</body>
</html>